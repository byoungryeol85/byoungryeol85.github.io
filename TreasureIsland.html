<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë³´ë¬¼ì„¬ íƒí—˜ 6Ã—6</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #3ba7ff 0, #00529b 40%, #001a33 100%);
      color: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 16px;
    }

    .game-container {
      width: 100%;
      max-width: 380px;
      margin: 0 auto;
      background: #20160d;
      border-radius: 18px;
      padding: 16px 16px 20px;
      box-shadow: 0 12px 32px rgba(0,0,0,0.7);
      border: 2px solid #d1a66a;
      position: relative;
      overflow: hidden;
    }

    .game-container::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: radial-gradient(circle at 10% 0, rgba(255,255,255,0.08), transparent 55%),
                        radial-gradient(circle at 90% 100%, rgba(255,255,255,0.05), transparent 55%);
      pointer-events: none;
      opacity: 0.7;
    }

    h1 {
      font-family: "Trebuchet MS", system-ui, sans-serif;
      letter-spacing: 1px;
      font-size: 1.3rem;
      text-align: center;
      margin: 0 0 8px;
      color: #ffe9b3;
      position: relative;
      z-index: 1;
    }

    .info {
      font-size: 0.85rem;
      text-align: center;
      margin-bottom: 12px;
      color: #e0d1b3;
      position: relative;
      z-index: 1;
    }

    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-size: 0.9rem;
      gap: 8px;
      flex-wrap: wrap;
      position: relative;
      z-index: 1;
    }

    .status-item {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(34, 26, 16, 0.9);
      border: 1px solid #85663a;
      color: #f3e2c4;
    }

    .button-group {
      display: flex;
      gap: 6px;
    }

    button {
      padding: 6px 10px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 600;
      color: #1a1208;
      box-shadow: 0 2px 0 rgba(0, 0, 0, 0.3);
    }

    #resetBtn {
      background: #ffd76b;
    }

    #revealBtn {
      background: #ff8a80;
    }

    button:active:not(:disabled) {
      transform: translateY(1px);
      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.5);
    }

    button:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }

    .grid-wrapper {
      position: relative;
      padding: 10px;
      border-radius: 12px;
      background: radial-gradient(circle at top, #f8e0a2 0, #c99b5c 45%, #8b5b2a 100%);
      box-shadow: inset 0 0 12px rgba(0,0,0,0.4);
      margin-bottom: 10px;
      z-index: 1;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 4px;
    }

    .tile {
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      color: #1a1208;
      cursor: pointer;
      user-select: none;
      touch-action: manipulation;
      transition: background 0.15s ease, transform 0.05s ease, box-shadow 0.15s ease, border 0.15s ease;
      background: linear-gradient(145deg, #f6e0a6, #e0b96c);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.5),
        0 2px 0 rgba(135,79,24,0.7);
      border: 1px solid rgba(138,95,45,0.7);
      position: relative;
      overflow: hidden;
    }

    .tile::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.25), transparent 50%);
      opacity: 0.8;
      pointer-events: none;
    }

    .tile:active {
      transform: translateY(1px);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.4),
        0 1px 0 rgba(135,79,24,0.8);
    }

    .tile.revealed {
      background: linear-gradient(145deg, #f0d89b, #d3b06c);
      color: #1a1208;
      cursor: default;
      box-shadow:
        inset 0 2px 3px rgba(0,0,0,0.25),
        0 1px 0 rgba(135,79,24,0.7);
    }

    /* ë³´ë¬¼ */
    .tile.treasure {
      background: radial-gradient(circle at 30% 20%, #fff8e1, #ffca28);
      color: #4a2d00;
      font-size: 1.3rem;
      box-shadow:
        0 0 12px rgba(255, 235, 59, 0.9),
        inset 0 2px 4px rgba(0,0,0,0.35);
      border: 2px solid #ffecb3;
    }

    /* ë°”ìœ„(ì¥ì• ë¬¼) */
    .tile.rock {
      background: radial-gradient(circle at 20% 15%, #7e888f, #30363b);
      box-shadow:
        inset 0 2px 3px rgba(255,255,255,0.2),
        0 2px 0 rgba(0,0,0,0.6);
      border: 1px solid #22282c;
      color: #e0e4e7;
      cursor: default;
      font-size: 1.1rem;
    }

    .tile.rock::after {
      opacity: 0.2;
    }

    /* íŒíŠ¸ ìƒ‰ìƒ í‘œì‹œ */
    .tile.hint-near {
      box-shadow:
        inset 0 0 0 3px rgba(76, 175, 80, 0.9),
        0 2px 0 rgba(135,79,24,0.7);
    }

    .tile.hint-mid {
      box-shadow:
        inset 0 0 0 3px rgba(255, 235, 59, 0.9),
        0 2px 0 rgba(135,79,24,0.7);
    }

    .message {
      min-height: 1.5em;
      font-size: 0.9rem;
      text-align: center;
      color: #f3e2c4;
      position: relative;
      z-index: 1;
    }

    /* í† ìŠ¤íŠ¸ UI */
    .toast {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%) translateY(20px);
      background: rgba(20, 20, 20, 0.9);
      color: #fefefe;
      padding: 10px 16px;
      border-radius: 999px;
      font-size: 0.9rem;
      max-width: 80%;
      text-align: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease, transform 0.2s ease;
      z-index: 9999;
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.1);
    }

    .toast.show {
      opacity: 1;
      transform: translate(-50%, -50%) translateY(0);
    }

    /* ì œí•œ íšŸìˆ˜ íŒì—… ëª¨ë‹¬ */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9998;
    }

    .modal-backdrop.show {
      display: flex;
    }

    .modal {
      background: #2a1b0f;
      border-radius: 16px;
      padding: 16px 18px 14px;
      max-width: 280px;
      width: 90%;
      box-shadow: 0 10px 24px rgba(0,0,0,0.8);
      border: 1px solid #d1a66a;
      color: #f5e3c3;
      text-align: center;
      font-size: 0.9rem;
      position: relative;
    }

    .modal-title {
      font-weight: 700;
      margin-bottom: 8px;
      font-size: 1rem;
      color: #ffe1a0;
    }

    .modal-buttons {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .btn-ad {
      background: #ffd76b;
      min-width: 140px;
    }

    .btn-giveup {
      background: #ff8a80;
      min-width: 120px;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <h1>ë³´ë¬¼ì„¬ íƒí—˜ 6Ã—6</h1>
    <div class="info">
      6Ã—6 ì„¬ íƒ€ì¼ ì¤‘ <strong>1ê°œ</strong>ì— ë³´ë¬¼ì´ ìˆ¨ê²¨ì ¸ ìˆì–´ìš”.<br>
      ë°”ìœ„(â›°ï¸) íƒ€ì¼ì€ ë§‰í˜€ ìˆì–´ì„œ í„°ì¹˜í•  ìˆ˜ ì—†ê³  ë³´ë¬¼ë„ ìˆ¨ê²¨ì ¸ ìˆì§€ ì•Šì•„ìš”.<br>
      <strong>5ë²ˆ ì•ˆì—</strong> ë³´ë¬¼ì„ ì°¾ì§€ ëª»í•˜ë©´ ê¸°íšŒê°€ ëë‚˜ìš”.<br>
      ê´‘ê³ ë¥¼ ë³´ë©´ <strong>1ë²ˆ ë”</strong> íƒí—˜ ê¸°íšŒë¥¼ ì–»ì„ ìˆ˜ ìˆì–´ìš”.
    </div>

    <div class="status-bar">
      <div class="status-item">ì‹œë„: <span id="attempts">0</span>/5</div>
      <div class="status-item">ì°¾ì€ ë³´ë¬¼: <span id="found">0</span>/1</div>
      <div class="button-group">
        <button id="revealBtn" type="button">ì •ë‹µ ê³µê°œ</button>
        <button id="resetBtn" type="button">ë‹¤ì‹œ ì‹œì‘</button>
      </div>
    </div>

    <div class="grid-wrapper">
      <div id="grid" class="grid"></div>
    </div>
    <div id="message" class="message">ë³´ë¬¼ì„¬ì„ íƒí—˜í•´ ë³´ì„¸ìš”!</div>
  </div>

  <!-- í† ìŠ¤íŠ¸ UI -->
  <div id="toast" class="toast"></div>

  <!-- ì œí•œ íšŸìˆ˜ ëª¨ë‹¬ -->
  <div id="limitModalBackdrop" class="modal-backdrop">
    <div class="modal">
      <div class="modal-title">ì œí•œ íšŸìˆ˜ë¥¼ ëª¨ë‘ ì‚¬ìš©í–ˆì–´ìš”.</div>
      <div class="modal-text">
        ê´‘ê³ ë¥¼ ë³´ê³  í•œ ë²ˆ ë” íƒí—˜í•  ìˆ˜ ìˆì–´ìš”.<br>
        ì•„ë‹ˆë©´ í¬ê¸°í•˜ê³  ë³´ë¬¼ ìœ„ì¹˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </div>
      <div class="modal-buttons">
        <button id="adButton" class="btn-ad" type="button">
          ê´‘ê³  ë³´ê³  1íšŒ ë” ê¸°íšŒë¥¼ ì–»ê¸°
        </button>
        <button id="giveUpButton" class="btn-giveup" type="button">
          í¬ê¸°í•˜ê³  ë³´ë¬¼ ìœ„ì¹˜ í™•ì¸
        </button>
      </div>
    </div>
  </div>

  <script>
    const GRID_SIZE = 6;
    const TREASURE_COUNT = 1;
    const ROCK_COUNT = 6;
    const BASE_ATTEMPT_LIMIT = 5;

    let treasurePositions = new Set();
    let remainingTreasures = new Set();
    let rockPositions = new Set();
    let attempts = 0;
    let foundCount = 0;
    let gameOver = false;

    let toastTimeoutId = null;

    let extraAttemptUsed = false;   // ê´‘ê³  ì´ìš© ì—¬ë¶€
    let limitModalVisible = false;  // ëª¨ë‹¬ í‘œì‹œ ì—¬ë¶€

    // ë¬¸êµ¬ ë°°ë¦¬ì—ì´ì…˜
    const messages = {
      near: {
        toast: [
          'ì•„ì£¼ ê°€ê¹Œì´ì— ë³´ë¬¼ì´ ìˆì„ ê²ƒ ê°™ë‹¤!',
          'ì½”ì•ì— ë³´ë¬¼ì´ ìˆ¨ì–´ ìˆëŠ” ëŠë‚Œì´ì•¼!',
          'ì†ë§Œ ë»—ìœ¼ë©´ ë³´ë¬¼ì— ë‹¿ì„ ê²ƒ ê°™ì•„!',
          'ë°”ë¡œ ê·¼ì²˜ì—ì„œ ë°˜ì§ì´ëŠ” ê¸°ìš´ì´ ëŠê»´ì§„ë‹¤!'
        ],
        bottom: [
          'ì•„ì£¼ ê°€ê¹Œì´ì— ë³´ë¬¼ì´ ìˆ¨ì–´ ìˆëŠ” ê²ƒ ê°™ì•„ìš”!',
          'ì´ ì£¼ë³€ ì–´ë”˜ê°€ì— ë³´ë¬¼ì´ ê¼­ ìˆì„ ê²ƒ ê°™ì•„ìš”!',
          'ì¡°ê¸ˆë§Œ ë” ì˜ ì‚´í´ë³´ë©´ ë³´ë¬¼ì„ ì°¾ì„ ìˆ˜ ìˆì„ ê±°ì˜ˆìš”!',
          'í•œë‘ ì¹¸ ì•ˆì— ë³´ë¬¼ì´ ìˆì„ì§€ë„ ëª°ë¼ìš”!'
        ]
      },
      mid: {
        toast: [
          'ë³´ë¬¼ì´ ì–´ë””ì—”ê°€ ìˆì„ ê²ƒ ê°™ë‹¤.',
          'ì´ ê·¼ì²˜ ì–´ë”˜ê°€ì— ë³´ë¬¼ì´ ìˆ¨ê²¨ì ¸ ìˆëŠ” ëŠë‚Œì´ì•¼.',
          'ë©€ì§€ëŠ” ì•Šì§€ë§Œ ì¡°ê¸ˆ ë” ë‘˜ëŸ¬ë´ì•¼ í•  ê²ƒ ê°™ì•„.',
          'ë³´ë¬¼ì˜ ê¸°ìš´ì´ í¬ë¯¸í•˜ê²Œ ëŠê»´ì§„ë‹¤.'
        ],
        bottom: [
          'ì´ ê·¼ì²˜ ì–´ë”˜ê°€ì— ë³´ë¬¼ì´ ìˆì„ì§€ë„ ëª°ë¼ìš”.',
          'ì¡°ê¸ˆ ë” ëŒì•„ë‹¤ë‹ˆë©´ ë³´ë¬¼ ê¸°ìš´ì´ ë” ê°•í•´ì§ˆ ê±°ì˜ˆìš”.',
          'ì™„ì „ ë©€ì§€ëŠ” ì•Šì§€ë§Œ, ì•„ì§ ë”± ì°¾ê¸°ì—” ì• ë§¤í•´ìš”.',
          'ì—¬ê¸°ì„œë¶€í„° ë°©í–¥ì„ ì˜ ì¡ì•„ë³´ëŠ” ê²Œ ì¢‹ê² ì–´ìš”.'
        ]
      },
      far: {
        toast: [
          'ì´ëŸ° ê³³ì—ëŠ” ë³´ë¬¼ì€ ì—†ì„ ê²ƒ ê°™ë‹¤.',
          'ë³´ë¬¼ì€ ì´ ì£¼ë³€ì—ëŠ” ì•„ë‹Œ ê²ƒ ê°™ì•„.',
          'ë³´ë¬¼ ê¸°ìš´ì´ ì „í˜€ ëŠê»´ì§€ì§€ ì•ŠëŠ”ë‹¤.',
          'ì—¬ê¸°ëŠ” ê·¸ëƒ¥ í‰ë²”í•œ ë•…ì¸ ê²ƒ ê°™ë‹¤.'
        ],
        bottom: [
          'ë³´ë¬¼ì´ ì´ ê·¼ì²˜ì—ëŠ” ì—†ëŠ” ê²ƒ ê°™ì•„ìš”.',
          'ì—¬ê¸´ ì•„ë‹Œ ê²ƒ ê°™ìœ¼ë‹ˆ ë‹¤ë¥¸ ê³³ì„ íƒí—˜í•´ ë³´ì„¸ìš”.',
          'ë³´ë¬¼ì€ ê½¤ ë–¨ì–´ì§„ ê³³ì— ìˆ¨ì–´ ìˆëŠ” ê²ƒ ê°™ì•„ìš”.',
          'ë‹¤ë¥¸ ë°©í–¥ìœ¼ë¡œ ì´ë™í•´ ë³´ì„¸ìš”.'
        ]
      },
      noneLeft: {
        toast: [
          'ë” ì´ìƒ ì°¾ì„ ë³´ë¬¼ì´ ì—†ì–´ ë³´ì…ë‹ˆë‹¤.',
          'ì´ë¯¸ ëª¨ë“  ë³´ë¬¼ì„ ì°¾ì€ ê²ƒ ê°™ì•„ìš”.',
          'ì´ì œ ë” ì°¾ì„ ë³´ë¬¼ì´ ì—†ë„¤ìš”.'
        ],
        bottom: [
          'ë‚¨ì€ ë³´ë¬¼ì´ ë” ì´ìƒ ì—†ì–´ìš”.',
          'ì´ ì„¬ì˜ ë³´ë¬¼ì€ ëª¨ë‘ ë°œê²¬ëœ ê²ƒ ê°™ì•„ìš”.',
          'ì´ì œ íƒí—˜ì„ ë§ˆë¬´ë¦¬í•´ë„ ì¢‹ê² ì–´ìš”.'
        ]
      },
      foundTreasure: {
        toast: [
          'ë³´ë¬¼ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!',
          'ëŒ€ì„±ê³µ! ë³´ë¬¼ì„ ë°œê²¬í–ˆì–´ìš”!',
          'ì¶•í•˜í•©ë‹ˆë‹¤! ë³´ë¬¼ì„ ì†ì— ë„£ì—ˆì–´ìš”!'
        ]
      },
      reveal: {
        toast: [
          'ì •ë‹µì„ ëª¨ë‘ ê³µê°œí–ˆìŠµë‹ˆë‹¤.',
          'ë³´ë¬¼ ìœ„ì¹˜ë¥¼ ëª¨ë‘ ë³´ì—¬ì¤¬ì–´ìš”.',
          'ì´ì œ ë³´ë¬¼ì€ ë¹„ë°€ì´ ì•„ë‹ˆì—ìš”.'
        ]
      },
      extraChance: {
        toast: [
          '1íšŒ ì¶”ê°€ ê¸°íšŒë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤!',
          'ê´‘ê³  ë•ë¶„ì— í•œ ë²ˆ ë” íƒí—˜í•  ìˆ˜ ìˆì–´ìš”!',
          'ë³´ë„ˆìŠ¤ ê¸°íšŒ 1íšŒë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!'
        ]
      },
      noMoreAd: {
        toast: [
          'ê´‘ê³  ê¸°íšŒëŠ” í•œ ë²ˆë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.',
          'ì¶”ê°€ ê¸°íšŒëŠ” ì´ë¯¸ ì‚¬ìš©í–ˆì–´ìš”.',
          'ë” ì´ìƒ ê´‘ê³ ë¡œ ê¸°íšŒë¥¼ ëŠ˜ë¦´ ìˆ˜ ì—†ì–´ìš”.'
        ]
      }
    };

    function pickRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function indexToCoord(idx) {
      return {
        row: Math.floor(idx / GRID_SIZE),
        col: idx % GRID_SIZE
      };
    }

    // ëŒ€ê°ì„  ì¸ì ‘ë„ 1ì¹¸: Chebyshev ê±°ë¦¬
    function calcChebyshevDistance(idxA, idxB) {
      const { row: r1, col: c1 } = indexToCoord(idxA);
      const { row: r2, col: c2 } = indexToCoord(idxB);
      return Math.max(Math.abs(r1 - r2), Math.abs(c1 - c2));
    }

    function calcMinDistanceFromRemaining(idx) {
      if (remainingTreasures.size === 0) return null;

      let min = Infinity;
      remainingTreasures.forEach(tIdx => {
        const d = calcChebyshevDistance(idx, tIdx);
        if (d < min) min = d;
      });

      return min;
    }

    function getCurrentAttemptLimit() {
      return BASE_ATTEMPT_LIMIT + (extraAttemptUsed ? 1 : 0);
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;

      if (toastTimeoutId !== null) {
        clearTimeout(toastTimeoutId);
      }

      toast.classList.add('show');

      toastTimeoutId = setTimeout(() => {
        toast.classList.remove('show');
        toastTimeoutId = null;
      }, 1200);
    }

    function applyHintVisual(tile, distance) {
      tile.classList.remove('hint-near', 'hint-mid');

      if (distance === null || distance >= 4) {
        return;
      }

      if (distance === 1) {
        tile.classList.add('hint-near');
      } else if (distance === 2 || distance === 3) {
        tile.classList.add('hint-mid');
      }
    }

    function updateAllRevealedHints() {
      const grid = document.getElementById('grid');
      const tiles = grid.children;

      for (let i = 0; i < tiles.length; i++) {
        const tile = tiles[i];
        const idx = parseInt(tile.dataset.index, 10);

        if (
          tile.classList.contains('revealed') &&
          !tile.classList.contains('treasure') &&
          !tile.classList.contains('rock')
        ) {
          const d = calcMinDistanceFromRemaining(idx);
          applyHintVisual(tile, d);
        }
      }
    }

    function showLimitModal() {
      if (limitModalVisible || gameOver) return;

      limitModalVisible = true;
      const backdrop = document.getElementById('limitModalBackdrop');
      const adButton = document.getElementById('adButton');

      backdrop.classList.add('show');

      // ê´‘ê³  ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
      if (extraAttemptUsed) {
        adButton.disabled = true;
        adButton.textContent = 'ê´‘ê³  ê¸°íšŒëŠ” ì´ë¯¸ ì‚¬ìš©í–ˆì–´ìš”';
      } else {
        adButton.disabled = false;
        adButton.textContent = 'ê´‘ê³  ë³´ê³  1íšŒ ë” ê¸°íšŒë¥¼ ì–»ê¸°';
      }
    }

    function hideLimitModal() {
      limitModalVisible = false;
      const backdrop = document.getElementById('limitModalBackdrop');
      backdrop.classList.remove('show');
    }

    function onTileClick(event) {
      if (gameOver) return;

      const tile = event.currentTarget;
      const idx = parseInt(tile.dataset.index, 10);

      if (rockPositions.has(idx)) return;
      if (tile.classList.contains('revealed')) return;

      tile.classList.add('revealed');
      attempts++;
      document.getElementById('attempts').textContent = attempts + '/' + BASE_ATTEMPT_LIMIT;

      const msgEl = document.getElementById('message');

      if (treasurePositions.has(idx)) {
        // ë³´ë¬¼ ë°œê²¬
        tile.classList.add('treasure');
        tile.textContent = 'ğŸ’°';

        foundCount++;
        document.getElementById('found').textContent = foundCount;

        remainingTreasures.delete(idx);
        updateAllRevealedHints();

        msgEl.textContent = pickRandom(messages.foundTreasure.toast);
        showToast(pickRandom(messages.foundTreasure.toast));

        gameOver = true;
        return;
      }

      // ë³´ë¬¼ ëª» ì°¾ì€ ê²½ìš° íŒíŠ¸ ì²˜ë¦¬
      const d = calcMinDistanceFromRemaining(idx);
      applyHintVisual(tile, d);

      if (d === null) {
        const bMsg = pickRandom(messages.noneLeft.bottom);
        const tMsg = pickRandom(messages.noneLeft.toast);
        msgEl.textContent = bMsg;
        showToast(tMsg);
      } else if (d === 1) {
        const bMsg = pickRandom(messages.near.bottom);
        const tMsg = pickRandom(messages.near.toast);
        msgEl.textContent = bMsg;
        showToast(tMsg);
      } else if (d === 2 || d === 3) {
        const bMsg = pickRandom(messages.mid.bottom);
        const tMsg = pickRandom(messages.mid.toast);
        msgEl.textContent = bMsg;
        showToast(tMsg);
      } else {
        const bMsg = pickRandom(messages.far.bottom);
        const tMsg = pickRandom(messages.far.toast);
        msgEl.textContent = bMsg;
        showToast(tMsg);
      }

      // ì‹œë„ ì œí•œ ì²´í¬ (ë³´ë¬¼ì„ ì•„ì§ ëª» ì°¾ì•˜ê³ , í˜„ì¬ í•œë„ê¹Œì§€ ì‚¬ìš©í–ˆì„ ë•Œ)
      if (!gameOver && attempts >= getCurrentAttemptLimit()) {
        showLimitModal();
      }
    }

    function revealAllTreasures() {
      const grid = document.getElementById('grid');
      const tiles = grid.children;

      for (let i = 0; i < tiles.length; i++) {
        const tile = tiles[i];
        const idx = parseInt(tile.dataset.index, 10);

        if (rockPositions.has(idx)) continue;

        if (!tile.classList.contains('revealed')) {
          tile.classList.add('revealed');
        }

        if (treasurePositions.has(idx)) {
          tile.classList.add('treasure');
          tile.textContent = 'ğŸ’°';
        }
      }

      gameOver = true;
      document.getElementById('message').textContent =
        'ì •ë‹µì„ ê³µê°œí–ˆì–´ìš”! ë‹¤ì‹œ í•˜ë ¤ë©´ "ë‹¤ì‹œ ì‹œì‘"ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.';
      showToast(pickRandom(messages.reveal.toast));
    }

    function initGame() {
      treasurePositions = new Set();
      remainingTreasures = new Set();
      rockPositions = new Set();
      attempts = 0;
      foundCount = 0;
      gameOver = false;
      extraAttemptUsed = false;
      limitModalVisible = false;

      const backdrop = document.getElementById('limitModalBackdrop');
      backdrop.classList.remove('show');

      // ë³´ë¬¼ ìœ„ì¹˜ ëœë¤(1ê°œ)
      while (treasurePositions.size < TREASURE_COUNT) {
        const idx = Math.floor(Math.random() * GRID_SIZE * GRID_SIZE);
        treasurePositions.add(idx);
      }

      // ë°”ìœ„ ìœ„ì¹˜ ëœë¤ (ë³´ë¬¼ê³¼ ê²¹ì¹˜ì§€ ì•Šê²Œ)
      while (rockPositions.size < ROCK_COUNT) {
        const idx = Math.floor(Math.random() * GRID_SIZE * GRID_SIZE);
        if (!treasurePositions.has(idx)) {
          rockPositions.add(idx);
        }
      }

      treasurePositions.forEach(idx => remainingTreasures.add(idx));

      document.getElementById('attempts').textContent = attempts + '/' + BASE_ATTEMPT_LIMIT;
      document.getElementById('found').textContent = foundCount;
      document.getElementById('message').textContent = 'ë³´ë¬¼ì„¬ì„ íƒí—˜í•´ ë³´ì„¸ìš”!';

      const grid = document.getElementById('grid');
      grid.innerHTML = '';

      // íƒ€ì¼ ìƒì„±
      for (let i = 0; i < GRID_SIZE * GRID_SIZE; i++) {
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.dataset.index = i;
        tile.textContent = '';

        if (rockPositions.has(i)) {
          tile.classList.add('rock');
          tile.textContent = 'â›°ï¸';
        } else {
          tile.addEventListener('click', onTileClick);
        }

        grid.appendChild(tile);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      initGame();

      document.getElementById('resetBtn').addEventListener('click', () => {
        initGame();
      });

      document.getElementById('revealBtn').addEventListener('click', () => {
        if (!gameOver) {
          revealAllTreasures();
        }
      });

      const adButton = document.getElementById('adButton');
      const giveUpButton = document.getElementById('giveUpButton');

      adButton.addEventListener('click', () => {
        if (extraAttemptUsed) {
          showToast(pickRandom(messages.noMoreAd.toast));
          return;
        }

        extraAttemptUsed = true; // ì‹¤ì œ ê´‘ê³ ëŠ” ì—†ê³ , ê·¸ëƒ¥ 1íšŒ ì¶”ê°€
        const tMsg = pickRandom(messages.extraChance.toast);
        showToast(tMsg);

        hideLimitModal();
      });

      giveUpButton.addEventListener('click', () => {
        hideLimitModal();
        if (!gameOver) {
          revealAllTreasures();
        }
      });
    });
  </script>
</body>
</html>
